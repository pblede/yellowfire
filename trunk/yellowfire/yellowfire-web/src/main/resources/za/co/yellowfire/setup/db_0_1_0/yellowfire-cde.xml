<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd">
    <changeSet author="yellowfire" id="0.1.0">
        <createTable schemaName="cde" tableName="answer">
            <column autoIncrement="true" name="answer_id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_answer_id"/>
            </column>
            <column name="questionaire_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="question_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="person_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column defaultValueComputed="CURRENT_TIMESTAMP" name="create_ts" type="DATETIME"/>
            <column name="update_ts" type="DATETIME"/>
            <column name="version" type="INT"/>
        </createTable>
        <createTable schemaName="cde" tableName="answer_boolean">
            <column name="answer_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="answer_value" type="INT"/>
            <column defaultValueComputed="CURRENT_TIMESTAMP" name="create_ts" type="DATETIME"/>
            <column name="update_ts" type="DATETIME"/>
            <column name="version" type="INT"/>
        </createTable>
        <createTable schemaName="cde" tableName="answer_number">
            <column name="answer_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="answer_value" type="INT"/>
            <column defaultValueComputed="CURRENT_TIMESTAMP" name="create_ts" type="DATETIME"/>
            <column name="update_ts" type="DATETIME"/>
            <column name="version" type="INT"/>
        </createTable>
        <createTable schemaName="cde" tableName="answer_text">
            <column name="answer_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="answer_value" type="INT"/>
            <column defaultValueComputed="CURRENT_TIMESTAMP" name="create_ts" type="DATETIME"/>
            <column name="update_ts" type="DATETIME"/>
            <column name="version" type="INT"/>
        </createTable>
        <createTable schemaName="cde" tableName="notification">
            <column autoIncrement="true" name="notification_id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_notification_id"/>
            </column>
            <column name="notification_type" type="VARCHAR(32)">
                <constraints nullable="false"/>
            </column>
            <column name="notification_from" type="VARCHAR(128)">
                <constraints nullable="false"/>
            </column>
            <column name="notification_to" type="VARCHAR(256)">
                <constraints nullable="false"/>
            </column>
            <column name="notification_cc" type="VARCHAR(256)"/>
            <column name="notification_bcc" type="VARCHAR(256)"/>
            <column name="notification_subject" type="VARCHAR(256)"/>
            <column name="notification_body" type="VARCHAR(MAX)"/>
            <column name="notification_sent" type="DATETIME"/>
            <column name="create_ts" type="DATETIME"/>
            <column name="update_ts" type="DATETIME"/>
            <column name="version" type="INT"/>
            <column defaultValueBoolean="false" name="archived" type="bit"/>
        </createTable>
        <createTable schemaName="cde" tableName="outcome">
            <column autoIncrement="true" name="outcome_id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_outcome_id"/>
            </column>
            <column name="outcome_description" type="VARCHAR(64)">
                <constraints nullable="false"/>
            </column>
            <column name="create_ts" type="DATETIME"/>
            <column name="update_ts" type="DATETIME"/>
            <column name="version" type="INT"/>
        </createTable>
        <createTable schemaName="cde" tableName="question">
            <column autoIncrement="true" name="question_id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_question_id"/>
            </column>
            <column name="question_type_id" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="question_text" type="VARCHAR(1024)">
                <constraints nullable="false"/>
            </column>
            <column defaultValueComputed="CURRENT_TIMESTAMP" name="create_ts" type="DATETIME"/>
            <column name="update_ts" type="DATETIME"/>
            <column name="version" type="INT"/>
        </createTable>
        <createTable schemaName="cde" tableName="question_type">
            <column name="question_type_id" type="INT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_question_type_id"/>
            </column>
            <column name="question_type_description" type="VARCHAR(32)">
                <constraints nullable="false"/>
            </column>
            <column defaultValueComputed="CURRENT_TIMESTAMP" name="create_ts" type="DATETIME"/>
            <column name="update_ts" type="DATETIME"/>
            <column name="version" type="INT"/>
        </createTable>
        <createTable schemaName="cde" tableName="questionaire">
            <column autoIncrement="true" name="questionaire_id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_questionaire_id"/>
            </column>
            <column name="questionaire_name" type="VARCHAR(64)">
                <constraints nullable="false"/>
            </column>
            <column defaultValueComputed="CURRENT_TIMESTAMP" name="create_ts" type="DATETIME"/>
            <column name="update_ts" type="DATETIME"/>
            <column name="version" type="INT"/>
        </createTable>
        <createTable schemaName="cde" tableName="questionaire_question">
            <column name="questionaire_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="question_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column defaultValueComputed="CURRENT_TIMESTAMP" name="create_ts" type="DATETIME"/>
            <column name="update_ts" type="DATETIME"/>
            <column name="version" type="INT"/>
        </createTable>
        <createTable schemaName="cde" tableName="venue">
            <column autoIncrement="true" name="venue_id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_venue_id"/>
            </column>
            <column name="venue_name" type="VARCHAR(128)"/>
            <column name="venue_address" type="VARCHAR(512)"/>
            <column name="venue_gps" type="VARCHAR(128)"/>
            <column name="venue_longitude" type="decimal(10,7)"/>
            <column name="venue_latitude" type="decimal(10,7)"/>
            <column defaultValueNumeric="0" name="venue_type" type="SMALLINT"/>
            <column defaultValueComputed="CURRENT_TIMESTAMP" name="create_ts" type="DATETIME"/>
            <column name="update_ts" type="DATETIME"/>
            <column name="version" type="INT"/>
        </createTable>
        <addPrimaryKey columnNames="questionaire_id, question_id" constraintName="pk_questionaire_question_id" schemaName="cde" tableName="questionaire_question"/>
        <addForeignKeyConstraint baseColumnNames="person_id" baseTableName="answer" baseTableSchemaName="cde" constraintName="fk_answer_person_id" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="person_id" referencedTableName="person" referencedTableSchemaName="cde" referencesUniqueColumn="false"/>
        <addForeignKeyConstraint baseColumnNames="question_id" baseTableName="answer" baseTableSchemaName="cde" constraintName="fk_answer_question_id" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="question_id" referencedTableName="question" referencedTableSchemaName="cde" referencesUniqueColumn="false"/>
        <addForeignKeyConstraint baseColumnNames="questionaire_id" baseTableName="answer" baseTableSchemaName="cde" constraintName="fk_answer_questionaire_id" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="questionaire_id" referencedTableName="questionaire" referencedTableSchemaName="cde" referencesUniqueColumn="false"/>
        <addForeignKeyConstraint baseColumnNames="answer_id" baseTableName="answer_boolean" baseTableSchemaName="cde" constraintName="fk_answer_boolean_answer_id" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="answer_id" referencedTableName="answer" referencedTableSchemaName="cde" referencesUniqueColumn="false"/>
        <addForeignKeyConstraint baseColumnNames="answer_id" baseTableName="answer_number" baseTableSchemaName="cde" constraintName="fk_answer_number_answer_id" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="answer_id" referencedTableName="answer" referencedTableSchemaName="cde" referencesUniqueColumn="false"/>
        <addForeignKeyConstraint baseColumnNames="answer_id" baseTableName="answer_text" baseTableSchemaName="cde" constraintName="fk_answer_text_answer_id" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="answer_id" referencedTableName="answer" referencedTableSchemaName="cde" referencesUniqueColumn="false"/>
        <addForeignKeyConstraint baseColumnNames="question_type_id" baseTableName="question" baseTableSchemaName="cde" constraintName="fk_question_question_type_id" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="question_type_id" referencedTableName="question_type" referencedTableSchemaName="cde" referencesUniqueColumn="false"/>
        <addForeignKeyConstraint baseColumnNames="question_id" baseTableName="questionaire_question" baseTableSchemaName="cde" constraintName="fk_questionaire_question_question_id" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="question_id" referencedTableName="question" referencedTableSchemaName="cde" referencesUniqueColumn="false"/>
        <addForeignKeyConstraint baseColumnNames="questionaire_id" baseTableName="questionaire_question" baseTableSchemaName="cde" constraintName="fk_questionaire_question_questionaire_id" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="questionaire_id" referencedTableName="questionaire" referencedTableSchemaName="cde" referencesUniqueColumn="false"/>
    </changeSet>
    <changeSet author="yellowfire" id="0.1.0b">
        <sql endDelimiter=";" splitStatements="false" stripComments="true">
            declare @version varchar(25) = '0.1.0';
            if exists(select db_version from cde.version)
                update cde.version set db_version = @version, version = version + 1;
            else
                insert into cde.version (db_version, version) values (@version, 1);
        </sql>
    </changeSet>
</databaseChangeLog>
